@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation
@inject IHttpContextAccessor HttpContextAccessor

<AuthorizeView>
    <Authorized>
        <div class="logout-container">
            <span class="user-info">
                @if (!string.IsNullOrEmpty(context.User.Identity?.Name))
                {
                    <span>@context.User.Identity.Name</span>
                }
                else
                {
                    <span>@context.User.FindFirst("email")?.Value ?? "User"</span>
                }
            </span>
            <button class="btn btn-outline-danger btn-sm" @onclick="HandleLogout">
                <i class="bi bi-box-arrow-right"></i> Sign Out
            </button>
        </div>
    </Authorized>
    <NotAuthorized>
        <a href="/auth/login" class="btn btn-primary btn-sm">
            <i class="bi bi-box-arrow-in-right"></i> Sign In
        </a>
    </NotAuthorized>
</AuthorizeView>

@code {
    [Parameter] public string? ReturnUrl { get; set; }

    private async Task HandleLogout()
    {
        var returnUrl = ReturnUrl ?? "/";
        var logoutUrl = $"/auth/logout?returnUrl={Uri.EscapeDataString(returnUrl)}";
        
        Navigation.NavigateTo(logoutUrl, forceLoad: true);
        await Task.CompletedTask;
    }
}

<style>
    .logout-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .user-info {
        font-size: 0.9rem;
        color: #495057;
    }

    .btn-outline-danger {
        border-color: #dc3545;
        color: #dc3545;
    }

    .btn-outline-danger:hover {
        background-color: #dc3545;
        color: white;
    }
</style>
